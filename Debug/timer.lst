Zilog eZ80 Macro Assembler Version 4.3 (19073001)24-Jun-23     07:37:07     page:   1


PC     Object              I  Line    Source 
                           A     1    ; Zilog eZ80 ANSI C Compiler Release 3.4
                           A     2    ; -nomodsect -optspeed -noreduceopt -nopadbranc
                           A     3    ; -peephole -globalopt -localcse -const=ROM 
                           A     4    	FILE	"..\src\timer.c"
                           A     5    	.assume ADL=1
                           A     6    .DEBUG "C"
                           A     7    	SEGMENT CODE
                           A     8    ;    1	/*
                           A     9    ;    2	 * Title:			AGON Electron OS - 
                           A    10    ;    3	 * Author:			Dean Belfield
                           A    11    ;    4	 */
                           A    12    ;    5	
                           A    13    ;    6	#include <eZ80.h>
                           A    14    ;    7	#include <defines.h>
                           A    15    ;    8	
                           A    16    ;    9	#include "timer.h"
                           A    17    ;   10	
                           A    18    ;   11	// Configure Timer 0
                           A    19    ;   12	// Parameters:
                           A    20    ;   13	// - interval: Interval in ms
                           A    21    ;   14	// - clkdiv: 4, 16, 64 or 256
                           A    22    ;   15	// - clkflag: Other clock flags (interr
                           A    23    ;   16	// Returns:
                           A    24    ;   17	// - interval value
                           A    25    ;   18	//
                           A    26    ;   19	unsigned short init_timer0(int interval
000000                     A    27    _init_timer0:
                           A    28    .DEFINE "_init_timer0"
                           A    29    
                           A    30    .VALUE _init_timer0
                           A    31    
                           A    32    .CLASS 2
                           A    33    
                           A    34    .TYPE 77
                           A    35    
                           A    36    .ENDEF
                           A    37    
                           A    38    .BEGFUNC "init_timer0",19,"_init_timer0"
                           A    39    
                           A    40    .LINE 19
                           A    41    
                           A    42    .DEFINE "interval"
                           A    43    
                           A    44    .CLASS 65
                           A    45    
                           A    46    .VALUE 6
                           A    47    
                           A    48    .TYPE 4
                           A    49    
                           A    50    .ENDEF
                           A    51    
                           A    52    .DEFINE "clkdiv"
                           A    53    
                           A    54    .CLASS 65
                           A    55    
                           A    56    .VALUE 9
                           A    57    
                           A    58    .TYPE 4
                           A    59    
                           A    60    .ENDEF
                           A    61    
                           A    62    .DEFINE "ctrlbits"
                           A    63    
                           A    64    .CLASS 65
                           A    65    
                           A    66    .VALUE 12
                           A    67    
                           A    68    .TYPE 12
                           A    69    
                           A    70    .ENDEF
                           A    71    
                           A    72    .DEFINE "clkbits"
                           A    73    
                           A    74    .CLASS 65
                           A    75    
                           A    76    .VALUE -1
                           A    77    
                           A    78    .TYPE 12
                           A    79    
                           A    80    .ENDEF
                           A    81    
                           A    82    .DEFINE "rr"
                           A    83    
                           A    84    .CLASS 65
                           A    85    
                           A    86    .VALUE -3
                           A    87    
                           A    88    .TYPE 13
                           A    89    
                           A    90    .ENDEF
                           A    91    
                           A    92    .DEFINE "ctl"
                           A    93    
                           A    94    .CLASS 65
                           A    95    
                           A    96    .VALUE -4
                           A    97    
                           A    98    .TYPE 12
                           A    99    
                           A   100    .ENDEF
                           A   101    
000000 DDE5                A   102    	PUSH	IX
000002 DD210000 00         A   103    	LD	IX,0
000007 DD39                A   104    	ADD	IX,SP
000009 C5                  A   105    	PUSH	BC
00000A 3B                  A   106    	DEC	SP
                           A   107    ;   20		unsigned short	rr;
                           A   108    ;   21		unsigned char	clkbits = 0;
                           A   109    .LINE 21
                           A   110    
00000B DD36FF00            A   111    	LD	(IX+%FFFFFFFF),%0
                           A   112    ;   22		unsigned char	ctl;
                           A   113    ;   23	
                           A   114    ;   24		switch(clkdiv) {
                           A   115    .LINE 24
                           A   116    
00000F DD0709              A   117    	LD	BC,(IX+%9)
000012                     A   118    L__0:
000012 11400000            A   119    	LD	DE,64
000016 C5E1                A   120    	LD	HL,BC
000018 B7                  A   121    	OR	A,A
000019 ED52                A   122    	SBC	HL,DE
00001B 28 29               A   123    	JR	Z,L_1
00001D 21400000            A   124    	LD	HL,64
000021 B7                  A   125    	OR	A,A
000022 ED42                A   126    	SBC	HL,BC
000024 38 0D               A   127    	JR	C,L__2
000026 11100000            A   128    	LD	DE,16
00002A C5E1                A   129    	LD	HL,BC
00002C B7                  A   130    	OR	A,A
00002D ED52                A   131    	SBC	HL,DE
00002F 28 0F               A   132    	JR	Z,L_0
000031 18 1D               A   133    	JR	L_3
000033                     A   134    L__2:
000033 11000100            A   135    	LD	DE,256
000037 C5E1                A   136    	LD	HL,BC
000039 B7                  A   137    	OR	A,A
00003A ED52                A   138    	SBC	HL,DE
00003C 28 0E               A   139    	JR	Z,L_2
00003E 18 10               A   140    	JR	L_3
                           A   141    ;   25			case  16: clkbits = 0x04; break
000040                     A   142    L_0:
                           A   143    .LINE 25
                           A   144    
000040 DD36FF04            A   145    	LD	(IX+%FFFFFFFF),%4
000044 18 0A               A   146    	JR	L_3
                           A   147    ;   26			case  64: clkbits = 0x08; break
000046                     A   148    L_1:
                           A   149    .LINE 26
                           A   150    
000046 DD36FF08            A   151    	LD	(IX+%FFFFFFFF),%8
00004A 18 04               A   152    	JR	L_3
                           A   153    ;   27			case 256: clkbits = 0x0C; break
00004C                     A   154    L_2:
                           A   155    .LINE 27
                           A   156    
00004C DD36FF0C            A   157    	LD	(IX+%FFFFFFFF),%C
                           A   158    ;   28		}
000050                     A   159    L_3:
                           A   160    .LINE 28
                           A   161    
                           A   162    ;   29		
                           A   163    ;   30		ctl = (ctrlbits | clkbits);
                           A   164    .LINE 30
                           A   165    
000050 DD7E0C              A   166    	LD	A,(IX+%C)
000053 DDB6FF              A   167    	OR	A,(IX+%FFFFFFFF)
000056 DD77FC              A   168    	LD	(IX+%FFFFFFFC),A
                           A   169    ;   31		rr = (unsigned short)((SysClkFreq /
                           A   170    .LINE 31
                           A   171    
000059 2A 00 00 00         A   172    	LD	HL,(_SysClkFreq)
00005D 3A 03 00 00         A   173    	LD	A,(_SysClkFreq+3)
000061 5F                  A   174    	LD	E,A
000062 01640000            A   175    	LD	BC,100
000066 AF                  A   176    	XOR	A,A
000067 CD 00 00 00         A   177    	CALL	__ldivs
00006B DD0709              A   178    	LD	BC,(IX+%9)
00006E CD 00 00 00         A   179    	CALL	__itol
000072 CD 00 00 00         A   180    	CALL	__ldivs
000076 E5C1                A   181    	LD	BC,HL
000078 DD2706              A   182    	LD	HL,(IX+%6)
00007B CD 00 00 00         A   183    	CALL	__smulu
00007F DD75FD              A   184    	LD	(IX+%FFFFFFFD),L
000082 DD74FE              A   185    	LD	(IX+%FFFFFFFE),H
                           A   186    ;   32	
                           A   187    ;   33		TMR0_CTL = 0x00;					
                           A   188    .LINE 33
                           A   189    
000085 AF                  A   190    	XOR	A,A
000086 ED3980              A   191    	OUT0	(128),A
                           A   192    ;   34		TMR0_RR_L = (unsigned char)(rr);
                           A   193    .LINE 34
                           A   194    
000089 DD7EFD              A   195    	LD	A,(IX+%FFFFFFFD)
00008C ED3981              A   196    	OUT0	(129),A
                           A   197    ;   35		TMR0_RR_H = (unsigned char)(rr >> 8
                           A   198    .LINE 35
                           A   199    
00008F DD07FD              A   200    	LD	BC,(IX+%FFFFFFFD)
000092 CD 00 00 00         A   201    	CALL	__stoiu
000096 E5C1                A   202    	LD	BC,HL
000098 3B                  A   203    	DEC	SP
000099 C5                  A   204    	PUSH	BC
00009A 33                  A   205    	INC	SP
00009B F1                  A   206    	POP	AF
00009C 17ED62              A   207    	SEXT	HL
00009F E5                  A   208    	PUSH	HL
0000A0 C5                  A   209    	PUSH	BC
0000A1 33                  A   210    	INC	SP
0000A2 E1                  A   211    	POP	HL
0000A3 33                  A   212    	INC	SP
0000A4 33                  A   213    	INC	SP
0000A5 7D                  A   214    	LD	A,L
0000A6 ED3982              A   215    	OUT0	(130),A
                           A   216    ;   36	    TMR0_CTL = ctl;
                           A   217    .LINE 36
                           A   218    
0000A9 DD7EFC              A   219    	LD	A,(IX+%FFFFFFFC)
0000AC ED3980              A   220    	OUT0	(128),A
                           A   221    ;   37	
                           A   222    ;   38		return rr;
                           A   223    .LINE 38
                           A   224    
0000AF DD27FD              A   225    	LD	HL,(IX+%FFFFFFFD)
                           A   226    ;   39	}
                           A   227    .LINE 39
                           A   228    
0000B2 DDF9                A   229    	LD	SP,IX
0000B4 DDE1                A   230    	POP	IX
0000B6 C9                  A   231    	RET	
                           A   232    
                           A   233    
                           A   234    ;**************************** _init_timer0 ****
                           A   235    ;Name                         Addr/Register   S
                           A   236    ;_SysClkFreq                         IMPORT    
                           A   237    ;ctl                                   IX-4    
                           A   238    ;rr                                    IX-3    
                           A   239    ;clkbits                               IX-1    
                           A   240    ;ctrlbits                             IX+12    
                           A   241    ;clkdiv                                IX+9    
                           A   242    ;interval                              IX+6    
                           A   243    
                           A   244    
                           A   245    ; Stack Frame Size: 19 (bytes)
                           A   246    ;       Spill Code: 0 (instruction)
                           A   247    
                           A   248    
                           A   249    .ENDFUNC "init_timer0",39,"_init_timer0"
                           A   250    ;   40	
                           A   251    ;   41	// Enable Timer 0
                           A   252    ;   42	// Parameters:
                           A   253    ;   43	// - enable: 0 = disable, 1 = enable
                           A   254    ;   44	//
                           A   255    ;   45	void enable_timer0(unsigned char enable
0000B7                     A   256    _enable_timer0:
                           A   257    .DEFINE "_enable_timer0"
                           A   258    
                           A   259    .VALUE _enable_timer0
                           A   260    
                           A   261    .CLASS 2
                           A   262    
                           A   263    .TYPE 65
                           A   264    
                           A   265    .ENDEF
                           A   266    
                           A   267    .BEGFUNC "enable_timer0",45,"_enable_timer0"
                           A   268    
                           A   269    .LINE 45
                           A   270    
                           A   271    .DEFINE "enable"
                           A   272    
                           A   273    .CLASS 65
                           A   274    
                           A   275    .VALUE 6
                           A   276    
                           A   277    .TYPE 12
                           A   278    
                           A   279    .ENDEF
                           A   280    
                           A   281    .DEFINE "b"
                           A   282    
                           A   283    .CLASS 65
                           A   284    
                           A   285    .VALUE -1
                           A   286    
                           A   287    .TYPE 12
                           A   288    
                           A   289    .ENDEF
                           A   290    
0000B7 DDE5                A   291    	PUSH	IX
0000B9 DD210000 00         A   292    	LD	IX,0
0000BE DD39                A   293    	ADD	IX,SP
0000C0 3B                  A   294    	DEC	SP
                           A   295    ;   46		unsigned char b;
                           A   296    ;   47	
                           A   297    ;   48		if(enable <= 1) {
                           A   298    .LINE 48
                           A   299    
0000C1 3E01                A   300    	LD	A,%1
0000C3 DDBE06              A   301    	CP	A,(IX+%6)
0000C6 38 19               A   302    	JR	C,L_6
                           A   303    ;   49			b = TMR0_CTL;
                           A   304    .LINE 49
                           A   305    
0000C8 ED3880              A   306    	IN0	A,(128)
0000CB DD77FF              A   307    	LD	(IX+%FFFFFFFF),A
                           A   308    ;   50			b &= 0xFC;
                           A   309    .LINE 50
                           A   310    
0000CE E6FC                A   311    	AND	A,%FC
0000D0 DD77FF              A   312    	LD	(IX+%FFFFFFFF),A
                           A   313    ;   51			b |= (enable | 2); 
                           A   314    .LINE 51
                           A   315    
0000D3 DD7E06              A   316    	LD	A,(IX+%6)
0000D6 CBCF                A   317    	SET	%1,A
0000D8 DDB6FF              A   318    	OR	A,(IX+%FFFFFFFF)
0000DB DD77FF              A   319    	LD	(IX+%FFFFFFFF),A
                           A   320    ;   52			TMR0_CTL = b;	
                           A   321    .LINE 52
                           A   322    
0000DE ED3980              A   323    	OUT0	(128),A
                           A   324    ;   53		}
                           A   325    ;   54	}
0000E1                     A   326    L_6:
                           A   327    .LINE 54
                           A   328    
0000E1 DDF9                A   329    	LD	SP,IX
0000E3 DDE1                A   330    	POP	IX
0000E5 C9                  A   331    	RET	
                           A   332    
                           A   333    
                           A   334    ;**************************** _enable_timer0 **
                           A   335    ;Name                         Addr/Register   S
                           A   336    ;b                                     IX-1    
                           A   337    ;enable                                IX+6    
                           A   338    
                           A   339    
                           A   340    ; Stack Frame Size: 10 (bytes)
                           A   341    ;       Spill Code: 0 (instruction)
                           A   342    
                           A   343    
                           A   344    .ENDFUNC "enable_timer0",54,"_enable_timer0"
                           A   345    ;   55	
                           A   346    ;   56	// Get data count of Timer 0
                           A   347    ;   57	//
                           A   348    ;   58	unsigned short get_timer0() {
0000E6                     A   349    _get_timer0:
                           A   350    .DEFINE "_get_timer0"
                           A   351    
                           A   352    .VALUE _get_timer0
                           A   353    
                           A   354    .CLASS 2
                           A   355    
                           A   356    .TYPE 77
                           A   357    
                           A   358    .ENDEF
                           A   359    
                           A   360    .BEGFUNC "get_timer0",58,"_get_timer0"
                           A   361    
                           A   362    .LINE 58
                           A   363    
                           A   364    .DEFINE "l"
                           A   365    
                           A   366    .CLASS 65
                           A   367    
                           A   368    .VALUE -1
                           A   369    
                           A   370    .TYPE 12
                           A   371    
                           A   372    .ENDEF
                           A   373    
                           A   374    .DEFINE "h"
                           A   375    
                           A   376    .CLASS 65
                           A   377    
                           A   378    .VALUE -2
                           A   379    
                           A   380    .TYPE 12
                           A   381    
                           A   382    .ENDEF
                           A   383    
0000E6 DDE5                A   384    	PUSH	IX
0000E8 DD210000 00         A   385    	LD	IX,0
0000ED DD39                A   386    	ADD	IX,SP
0000EF 3B                  A   387    	DEC	SP
0000F0 3B                  A   388    	DEC	SP
                           A   389    ;   59		unsigned char l = TMR0_DR_L;
                           A   390    .LINE 59
                           A   391    
0000F1 ED3881              A   392    	IN0	A,(129)
0000F4 DD77FF              A   393    	LD	(IX+%FFFFFFFF),A
                           A   394    ;   60		unsigned char h = TMR0_DR_H;
                           A   395    .LINE 60
                           A   396    
0000F7 ED3882              A   397    	IN0	A,(130)
0000FA DD77FE              A   398    	LD	(IX+%FFFFFFFE),A
                           A   399    ;   61		return (h << 8) | l;
                           A   400    .LINE 61
                           A   401    
0000FD DD4EFE              A   402    	LD	C,(IX+%FFFFFFFE)
000100 0600                A   403    	LD	B,%0
000102 C5E1                A   404    	LD	HL,BC
000104 65                  A   405    	LD	H,L
000105 2E00                A   406    	LD	L,%0
000107 DD4EFF              A   407    	LD	C,(IX+%FFFFFFFF)
00010A CD 00 00 00         A   408    	CALL	__sor
                           A   409    ;   62	}
                           A   410    .LINE 62
                           A   411    
00010E DDF9                A   412    	LD	SP,IX
000110 DDE1                A   413    	POP	IX
000112 C9                  A   414    	RET	
                           A   415    
                           A   416    
                           A   417    ;**************************** _get_timer0 *****
                           A   418    ;Name                         Addr/Register   S
                           A   419    ;h                                     IX-2    
                           A   420    ;l                                     IX-1    
                           A   421    
                           A   422    
                           A   423    ; Stack Frame Size: 8 (bytes)
                           A   424    ;       Spill Code: 0 (instruction)
                           A   425    
                           A   426    
                           A   427    .ENDFUNC "get_timer0",62,"_get_timer0"
                           A   428    ;   63	
                           A   429    ;   64	// Configure Timer 1
                           A   430    ;   65	// Parameters:
                           A   431    ;   66	// - interval: Interval in ms
                           A   432    ;   67	// - clkdiv: 4, 16, 64 or 256
                           A   433    ;   68	// - clkflag: Other clock flags (interr
                           A   434    ;   69	// Returns:
                           A   435    ;   70	// - interval value
                           A   436    ;   71	//
                           A   437    ;   72	unsigned short init_timer1(int interval
000113                     A   438    _init_timer1:
                           A   439    .DEFINE "_init_timer1"
                           A   440    
                           A   441    .VALUE _init_timer1
                           A   442    
                           A   443    .CLASS 2
                           A   444    
                           A   445    .TYPE 77
                           A   446    
                           A   447    .ENDEF
                           A   448    
                           A   449    .BEGFUNC "init_timer1",72,"_init_timer1"
                           A   450    
                           A   451    .LINE 72
                           A   452    
                           A   453    .DEFINE "interval"
                           A   454    
                           A   455    .CLASS 65
                           A   456    
                           A   457    .VALUE 6
                           A   458    
                           A   459    .TYPE 4
                           A   460    
                           A   461    .ENDEF
                           A   462    
                           A   463    .DEFINE "clkdiv"
                           A   464    
                           A   465    .CLASS 65
                           A   466    
                           A   467    .VALUE 9
                           A   468    
                           A   469    .TYPE 4
                           A   470    
                           A   471    .ENDEF
                           A   472    
                           A   473    .DEFINE "ctrlbits"
                           A   474    
                           A   475    .CLASS 65
                           A   476    
                           A   477    .VALUE 12
                           A   478    
                           A   479    .TYPE 12
                           A   480    
                           A   481    .ENDEF
                           A   482    
                           A   483    .DEFINE "clkbits"
                           A   484    
                           A   485    .CLASS 65
                           A   486    
                           A   487    .VALUE -1
                           A   488    
                           A   489    .TYPE 12
                           A   490    
                           A   491    .ENDEF
                           A   492    
                           A   493    .DEFINE "rr"
                           A   494    
                           A   495    .CLASS 65
                           A   496    
                           A   497    .VALUE -3
                           A   498    
                           A   499    .TYPE 13
                           A   500    
                           A   501    .ENDEF
                           A   502    
                           A   503    .DEFINE "ctl"
                           A   504    
                           A   505    .CLASS 65
                           A   506    
                           A   507    .VALUE -4
                           A   508    
                           A   509    .TYPE 12
                           A   510    
                           A   511    .ENDEF
                           A   512    
000113 DDE5                A   513    	PUSH	IX
000115 DD210000 00         A   514    	LD	IX,0
00011A DD39                A   515    	ADD	IX,SP
00011C C5                  A   516    	PUSH	BC
00011D 3B                  A   517    	DEC	SP
                           A   518    ;   73		unsigned short	rr;
                           A   519    ;   74		unsigned char	clkbits = 0;
                           A   520    .LINE 74
                           A   521    
00011E DD36FF00            A   522    	LD	(IX+%FFFFFFFF),%0
                           A   523    ;   75		unsigned char	ctl;
                           A   524    ;   76	
                           A   525    ;   77		switch(clkdiv) {
                           A   526    .LINE 77
                           A   527    
000122 DD0709              A   528    	LD	BC,(IX+%9)
000125                     A   529    L__8:
000125 11400000            A   530    	LD	DE,64
000129 C5E1                A   531    	LD	HL,BC
00012B B7                  A   532    	OR	A,A
00012C ED52                A   533    	SBC	HL,DE
00012E 28 29               A   534    	JR	Z,L_9
000130 21400000            A   535    	LD	HL,64
000134 B7                  A   536    	OR	A,A
000135 ED42                A   537    	SBC	HL,BC
000137 38 0D               A   538    	JR	C,L__10
000139 11100000            A   539    	LD	DE,16
00013D C5E1                A   540    	LD	HL,BC
00013F B7                  A   541    	OR	A,A
000140 ED52                A   542    	SBC	HL,DE
000142 28 0F               A   543    	JR	Z,L_8
000144 18 1D               A   544    	JR	L_11
000146                     A   545    L__10:
000146 11000100            A   546    	LD	DE,256
00014A C5E1                A   547    	LD	HL,BC
00014C B7                  A   548    	OR	A,A
00014D ED52                A   549    	SBC	HL,DE
00014F 28 0E               A   550    	JR	Z,L_10
000151 18 10               A   551    	JR	L_11
                           A   552    ;   78			case  16: clkbits = 0x04; break
000153                     A   553    L_8:
                           A   554    .LINE 78
                           A   555    
000153 DD36FF04            A   556    	LD	(IX+%FFFFFFFF),%4
000157 18 0A               A   557    	JR	L_11
                           A   558    ;   79			case  64: clkbits = 0x08; break
000159                     A   559    L_9:
                           A   560    .LINE 79
                           A   561    
000159 DD36FF08            A   562    	LD	(IX+%FFFFFFFF),%8
00015D 18 04               A   563    	JR	L_11
                           A   564    ;   80			case 256: clkbits = 0x0C; break
00015F                     A   565    L_10:
                           A   566    .LINE 80
                           A   567    
00015F DD36FF0C            A   568    	LD	(IX+%FFFFFFFF),%C
                           A   569    ;   81		}
000163                     A   570    L_11:
                           A   571    .LINE 81
                           A   572    
                           A   573    ;   82		ctl = (ctrlbits | clkbits);
                           A   574    .LINE 82
                           A   575    
000163 DD7E0C              A   576    	LD	A,(IX+%C)
000166 DDB6FF              A   577    	OR	A,(IX+%FFFFFFFF)
000169 DD77FC              A   578    	LD	(IX+%FFFFFFFC),A
                           A   579    ;   83	
                           A   580    ;   84		rr = (unsigned short)((SysClkFreq /
                           A   581    .LINE 84
                           A   582    
00016C 2A 00 00 00         A   583    	LD	HL,(_SysClkFreq)
000170 3A 03 00 00         A   584    	LD	A,(_SysClkFreq+3)
000174 5F                  A   585    	LD	E,A
000175 01640000            A   586    	LD	BC,100
000179 AF                  A   587    	XOR	A,A
00017A CD 00 00 00         A   588    	CALL	__ldivs
00017E DD0709              A   589    	LD	BC,(IX+%9)
000181 CD 00 00 00         A   590    	CALL	__itol
000185 CD 00 00 00         A   591    	CALL	__ldivs
000189 E5C1                A   592    	LD	BC,HL
00018B DD2706              A   593    	LD	HL,(IX+%6)
00018E CD 00 00 00         A   594    	CALL	__smulu
000192 DD75FD              A   595    	LD	(IX+%FFFFFFFD),L
000195 DD74FE              A   596    	LD	(IX+%FFFFFFFE),H
                           A   597    ;   85	
                           A   598    ;   86		TMR1_CTL = 0x00;					
                           A   599    .LINE 86
                           A   600    
000198 AF                  A   601    	XOR	A,A
000199 ED3983              A   602    	OUT0	(131),A
                           A   603    ;   87		TMR1_RR_L = (unsigned char)(rr);
                           A   604    .LINE 87
                           A   605    
00019C DD7EFD              A   606    	LD	A,(IX+%FFFFFFFD)
00019F ED3984              A   607    	OUT0	(132),A
                           A   608    ;   88		TMR1_RR_H = (unsigned char)(rr >> 8
                           A   609    .LINE 88
                           A   610    
0001A2 DD07FD              A   611    	LD	BC,(IX+%FFFFFFFD)
0001A5 CD 00 00 00         A   612    	CALL	__stoiu
0001A9 E5C1                A   613    	LD	BC,HL
0001AB 3B                  A   614    	DEC	SP
0001AC C5                  A   615    	PUSH	BC
0001AD 33                  A   616    	INC	SP
0001AE F1                  A   617    	POP	AF
0001AF 17ED62              A   618    	SEXT	HL
0001B2 E5                  A   619    	PUSH	HL
0001B3 C5                  A   620    	PUSH	BC
0001B4 33                  A   621    	INC	SP
0001B5 E1                  A   622    	POP	HL
0001B6 33                  A   623    	INC	SP
0001B7 33                  A   624    	INC	SP
0001B8 7D                  A   625    	LD	A,L
0001B9 ED3985              A   626    	OUT0	(133),A
                           A   627    ;   89	    TMR1_CTL = ctl;
                           A   628    .LINE 89
                           A   629    
0001BC DD7EFC              A   630    	LD	A,(IX+%FFFFFFFC)
0001BF ED3983              A   631    	OUT0	(131),A
                           A   632    ;   90	
                           A   633    ;   91		return rr;
                           A   634    .LINE 91
                           A   635    
0001C2 DD27FD              A   636    	LD	HL,(IX+%FFFFFFFD)
                           A   637    ;   92	}
                           A   638    .LINE 92
                           A   639    
0001C5 DDF9                A   640    	LD	SP,IX
0001C7 DDE1                A   641    	POP	IX
0001C9 C9                  A   642    	RET	
                           A   643    
                           A   644    
                           A   645    ;**************************** _init_timer1 ****
                           A   646    ;Name                         Addr/Register   S
                           A   647    ;_SysClkFreq                         IMPORT    
                           A   648    ;ctl                                   IX-4    
                           A   649    ;rr                                    IX-3    
                           A   650    ;clkbits                               IX-1    
                           A   651    ;ctrlbits                             IX+12    
                           A   652    ;clkdiv                                IX+9    
                           A   653    ;interval                              IX+6    
                           A   654    
                           A   655    
                           A   656    ; Stack Frame Size: 19 (bytes)
                           A   657    ;       Spill Code: 0 (instruction)
                           A   658    
                           A   659    
                           A   660    .ENDFUNC "init_timer1",92,"_init_timer1"
                           A   661    ;   93	
                           A   662    ;   94	// Enable Timer 1
                           A   663    ;   95	// Parameters:
                           A   664    ;   96	// - enable: 0 = disable, 1 = enable
                           A   665    ;   97	//
                           A   666    ;   98	void enable_timer1(unsigned char enable
0001CA                     A   667    _enable_timer1:
                           A   668    .DEFINE "_enable_timer1"
                           A   669    
                           A   670    .VALUE _enable_timer1
                           A   671    
                           A   672    .CLASS 2
                           A   673    
                           A   674    .TYPE 65
                           A   675    
                           A   676    .ENDEF
                           A   677    
                           A   678    .BEGFUNC "enable_timer1",98,"_enable_timer1"
                           A   679    
                           A   680    .LINE 98
                           A   681    
                           A   682    .DEFINE "enable"
                           A   683    
                           A   684    .CLASS 65
                           A   685    
                           A   686    .VALUE 6
                           A   687    
                           A   688    .TYPE 12
                           A   689    
                           A   690    .ENDEF
                           A   691    
                           A   692    .DEFINE "b"
                           A   693    
                           A   694    .CLASS 65
                           A   695    
                           A   696    .VALUE -1
                           A   697    
                           A   698    .TYPE 12
                           A   699    
                           A   700    .ENDEF
                           A   701    
0001CA DDE5                A   702    	PUSH	IX
0001CC DD210000 00         A   703    	LD	IX,0
0001D1 DD39                A   704    	ADD	IX,SP
0001D3 3B                  A   705    	DEC	SP
                           A   706    ;   99		unsigned char b;
                           A   707    ;  100	
                           A   708    ;  101		if(enable <= 1) {
                           A   709    .LINE 101
                           A   710    
0001D4 3E01                A   711    	LD	A,%1
0001D6 DDBE06              A   712    	CP	A,(IX+%6)
0001D9 38 19               A   713    	JR	C,L_14
                           A   714    ;  102			b = TMR1_CTL;
                           A   715    .LINE 102
                           A   716    
0001DB ED3883              A   717    	IN0	A,(131)
0001DE DD77FF              A   718    	LD	(IX+%FFFFFFFF),A
                           A   719    ;  103			b &= 0xFC;
                           A   720    .LINE 103
                           A   721    
0001E1 E6FC                A   722    	AND	A,%FC
0001E3 DD77FF              A   723    	LD	(IX+%FFFFFFFF),A
                           A   724    ;  104			b |= (enable | 2); 
                           A   725    .LINE 104
                           A   726    
0001E6 DD7E06              A   727    	LD	A,(IX+%6)
0001E9 CBCF                A   728    	SET	%1,A
0001EB DDB6FF              A   729    	OR	A,(IX+%FFFFFFFF)
0001EE DD77FF              A   730    	LD	(IX+%FFFFFFFF),A
                           A   731    ;  105			TMR1_CTL = b;	
                           A   732    .LINE 105
                           A   733    
0001F1 ED3983              A   734    	OUT0	(131),A
                           A   735    ;  106		}
                           A   736    ;  107	}
0001F4                     A   737    L_14:
                           A   738    .LINE 107
                           A   739    
0001F4 DDF9                A   740    	LD	SP,IX
0001F6 DDE1                A   741    	POP	IX
0001F8 C9                  A   742    	RET	
                           A   743    
                           A   744    
                           A   745    ;**************************** _enable_timer1 **
                           A   746    ;Name                         Addr/Register   S
                           A   747    ;b                                     IX-1    
                           A   748    ;enable                                IX+6    
                           A   749    
                           A   750    
                           A   751    ; Stack Frame Size: 10 (bytes)
                           A   752    ;       Spill Code: 0 (instruction)
                           A   753    
                           A   754    
                           A   755    .ENDFUNC "enable_timer1",107,"_enable_timer1"
                           A   756    ;  108	
                           A   757    ;  109	// Get data count of Timer 1
                           A   758    ;  110	//
                           A   759    ;  111	unsigned short get_timer1() {
0001F9                     A   760    _get_timer1:
                           A   761    .DEFINE "_get_timer1"
                           A   762    
                           A   763    .VALUE _get_timer1
                           A   764    
                           A   765    .CLASS 2
                           A   766    
                           A   767    .TYPE 77
                           A   768    
                           A   769    .ENDEF
                           A   770    
                           A   771    .BEGFUNC "get_timer1",111,"_get_timer1"
                           A   772    
                           A   773    .LINE 111
                           A   774    
                           A   775    .DEFINE "l"
                           A   776    
                           A   777    .CLASS 65
                           A   778    
                           A   779    .VALUE -1
                           A   780    
                           A   781    .TYPE 12
                           A   782    
                           A   783    .ENDEF
                           A   784    
                           A   785    .DEFINE "h"
                           A   786    
                           A   787    .CLASS 65
                           A   788    
                           A   789    .VALUE -2
                           A   790    
                           A   791    .TYPE 12
                           A   792    
                           A   793    .ENDEF
                           A   794    
0001F9 DDE5                A   795    	PUSH	IX
0001FB DD210000 00         A   796    	LD	IX,0
000200 DD39                A   797    	ADD	IX,SP
000202 3B                  A   798    	DEC	SP
000203 3B                  A   799    	DEC	SP
                           A   800    ;  112		unsigned char l = TMR1_DR_L;
                           A   801    .LINE 112
                           A   802    
000204 ED3884              A   803    	IN0	A,(132)
000207 DD77FF              A   804    	LD	(IX+%FFFFFFFF),A
                           A   805    ;  113		unsigned char h = TMR1_DR_H;
                           A   806    .LINE 113
                           A   807    
00020A ED3885              A   808    	IN0	A,(133)
00020D DD77FE              A   809    	LD	(IX+%FFFFFFFE),A
                           A   810    ;  114		return (h << 8) | l;
                           A   811    .LINE 114
                           A   812    
000210 DD4EFE              A   813    	LD	C,(IX+%FFFFFFFE)
000213 0600                A   814    	LD	B,%0
000215 C5E1                A   815    	LD	HL,BC
000217 65                  A   816    	LD	H,L
000218 2E00                A   817    	LD	L,%0
00021A DD4EFF              A   818    	LD	C,(IX+%FFFFFFFF)
00021D CD 00 00 00         A   819    	CALL	__sor
                           A   820    .LINE 115
                           A   821    
000221 DDF9                A   822    	LD	SP,IX
000223 DDE1                A   823    	POP	IX
000225 C9                  A   824    	RET	
                           A   825    
                           A   826    
                           A   827    ;**************************** _get_timer1 *****
                           A   828    ;Name                         Addr/Register   S
                           A   829    ;h                                     IX-2    
                           A   830    ;l                                     IX-1    
                           A   831    
                           A   832    
                           A   833    ; Stack Frame Size: 8 (bytes)
                           A   834    ;       Spill Code: 0 (instruction)
                           A   835    
                           A   836    
                           A   837    .ENDFUNC "get_timer1",115,"_get_timer1"
                           A   838    	XREF _SysClkFreq:ROM
                           A   839    	XREF __ldivs:ROM
                           A   840    	XREF __sor:ROM
                           A   841    	XREF __smulu:ROM
                           A   842    	XREF __stoiu:ROM
                           A   843    	XREF __itol:ROM
                           A   844    	XDEF _get_timer1
                           A   845    	XDEF _enable_timer1
                           A   846    	XDEF _init_timer1
                           A   847    	XDEF _get_timer0
                           A   848    	XDEF _enable_timer0
                           A   849    	XDEF _init_timer0
                           A   850    	END


Errors: 0
Warnings: 0
Lines Assembled: 851
